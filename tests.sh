#!/bin/bash

# –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è Lottery API
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ localhost:8080

API_URL="http://localhost:8080"
LAST_RESPONSE=""  # –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ—Ç–≤–µ—Ç–∞

echo "=== –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Lottery API ==="
echo

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –≤—ã–≤–æ–¥–∞ JSON
pretty_json() {
    if command -v jq &> /dev/null; then
        echo "$1" | jq .
    else
        echo "$1"
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
make_request() {
    local method=$1
    local url=$2
    local data=$3
    local description=$4
    
    echo "--- $description ---"
    echo "–ó–∞–ø—Ä–æ—Å: $method $url"
    if [ ! -z "$data" ]; then
        echo "–î–∞–Ω–Ω—ã–µ: $data"
    fi
    echo
    
    if [ -z "$data" ]; then
        response=$(curl -s -X $method "$API_URL$url")
    else
        response=$(curl -s -X $method -H "Content-Type: application/json" -d "$data" "$API_URL$url")
    fi
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
    LAST_RESPONSE="$response"
    
    echo "–û—Ç–≤–µ—Ç:"
    pretty_json "$response"
    echo
    echo "----------------------------------------"
    echo
}

# –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏—Ä–∞–∂–∞
echo "üéØ –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏—Ä–∞–∂–∞"
make_request "POST" "/draws" "" "–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏—Ä–∞–∂–∞"

# –ü–æ–ª—É—á–∏–º ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —Ç–∏—Ä–∞–∂–∞ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ—Ç–≤–µ—Ç–∞
DRAW_ID=$(echo "$LAST_RESPONSE" | jq -r '.id')
if [ -z "$DRAW_ID" ] || [ "$DRAW_ID" == "null" ]; then
    echo "–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID —Ç–∏—Ä–∞–∂–∞ –∏–∑ –æ—Ç–≤–µ—Ç–∞"
    exit 1
fi
echo "–ü–æ–ª—É—á–µ–Ω–Ω—ã–π ID —Ç–∏—Ä–∞–∂–∞: $DRAW_ID"
echo

# –¢–µ—Å—Ç 2: –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –≤—Ç–æ—Ä–æ–π —Ç–∏—Ä–∞–∂ (–¥–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É)
echo "üéØ –¢–µ—Å—Ç 2: –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –≤—Ç–æ—Ä–æ–π –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∏—Ä–∞–∂"
make_request "POST" "/draws" "" "–°–æ–∑–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ —Ç–∏—Ä–∞–∂–∞ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞)"

# –¢–µ—Å—Ç 3: –ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–æ–≤
echo "üéØ –¢–µ—Å—Ç 3: –ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–æ–≤"
make_request "POST" "/tickets" "{\"numbers\": [1, 5, 12, 23, 36], \"draw_id\": $DRAW_ID}" "–ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–∞ #1"
make_request "POST" "/tickets" "{\"numbers\": [2, 8, 15, 24, 35], \"draw_id\": $DRAW_ID}" "–ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–∞ #2"
make_request "POST" "/tickets" "{\"numbers\": [3, 9, 16, 25, 34], \"draw_id\": $DRAW_ID}" "–ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–∞ #3"

# –¢–µ—Å—Ç 4: –í–∞–ª–∏–¥–∞—Ü–∏—è –±–∏–ª–µ—Ç–æ–≤
echo "üéØ –¢–µ—Å—Ç 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏"
make_request "POST" "/tickets" "{\"numbers\": [1, 2, 3, 4], \"draw_id\": $DRAW_ID}" "–ë–∏–ª–µ—Ç —Å 4 —á–∏—Å–ª–∞–º–∏ (–æ—à–∏–±–∫–∞)"
make_request "POST" "/tickets" "{\"numbers\": [1, 2, 3, 4, 5, 6], \"draw_id\": $DRAW_ID}" "–ë–∏–ª–µ—Ç —Å 6 —á–∏—Å–ª–∞–º–∏ (–æ—à–∏–±–∫–∞)"
make_request "POST" "/tickets" "{\"numbers\": [0, 2, 3, 4, 5], \"draw_id\": $DRAW_ID}" "–ë–∏–ª–µ—Ç —Å —á–∏—Å–ª–æ–º 0 (–æ—à–∏–±–∫–∞)"
make_request "POST" "/tickets" "{\"numbers\": [1, 2, 3, 4, 37], \"draw_id\": $DRAW_ID}" "–ë–∏–ª–µ—Ç —Å —á–∏—Å–ª–æ–º 37 (–æ—à–∏–±–∫–∞)"
make_request "POST" "/tickets" "{\"numbers\": [1, 1, 3, 4, 5], \"draw_id\": $DRAW_ID}" "–ë–∏–ª–µ—Ç —Å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–º–∏—Å—è —á–∏—Å–ª–∞–º–∏ (–æ—à–∏–±–∫–∞)"

# –¢–µ—Å—Ç 5: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–∏—Ä–∞–∂–µ
echo "üéØ –¢–µ—Å—Ç 5: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–∏—Ä–∞–∂–µ"
make_request "GET" "/draws/$DRAW_ID" "" "–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–∏—Ä–∞–∂–µ"

# –¢–µ—Å—Ç 6: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–∏—Ä–∞–∂–µ–π
echo "üéØ –¢–µ—Å—Ç 6: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–∏—Ä–∞–∂–µ–π"
make_request "GET" "/draws" "" "–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —Ç–∏—Ä–∞–∂–µ–π"

# –¢–µ—Å—Ç 7: –ó–∞–∫—Ä—ã—Ç–∏–µ —Ç–∏—Ä–∞–∂–∞
echo "üéØ –¢–µ—Å—Ç 7: –ó–∞–∫—Ä—ã—Ç–∏–µ —Ç–∏—Ä–∞–∂–∞"
make_request "POST" "/draws/$DRAW_ID/close" "" "–ó–∞–∫—Ä—ã—Ç–∏–µ —Ç–∏—Ä–∞–∂–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π"

# –¢–µ—Å—Ç 8: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
echo "üéØ –¢–µ—Å—Ç 8: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"
make_request "GET" "/draws/$DRAW_ID/results" "" "–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–∏—Ä–∞–∂–∞"

# –¢–µ—Å—Ç 9: –ü–æ–ø—ã—Ç–∫–∞ –∫—É–ø–∏—Ç—å –±–∏–ª–µ—Ç –≤ –∑–∞–∫—Ä—ã—Ç–æ–º —Ç–∏—Ä–∞–∂–µ
echo "üéØ –¢–µ—Å—Ç 9: –ü–æ–ø—ã—Ç–∫–∞ –∫—É–ø–∏—Ç—å –±–∏–ª–µ—Ç –≤ –∑–∞–∫—Ä—ã—Ç–æ–º —Ç–∏—Ä–∞–∂–µ"
make_request "POST" "/tickets" "{\"numbers\": [10, 11, 12, 13, 14], \"draw_id\": $DRAW_ID}" "–ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–∞ –≤ –∑–∞–∫—Ä—ã—Ç–æ–º —Ç–∏—Ä–∞–∂–µ (–æ—à–∏–±–∫–∞)"

# –¢–µ—Å—Ç 10: –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç—å —É–∂–µ –∑–∞–∫—Ä—ã—Ç—ã–π —Ç–∏—Ä–∞–∂
echo "üéØ –¢–µ—Å—Ç 10: –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç—å —É–∂–µ –∑–∞–∫—Ä—ã—Ç—ã–π —Ç–∏—Ä–∞–∂"
make_request "POST" "/draws/$DRAW_ID/close" "" "–ó–∞–∫—Ä—ã—Ç–∏–µ —É–∂–µ –∑–∞–∫—Ä—ã—Ç–æ–≥–æ —Ç–∏—Ä–∞–∂–∞ (–æ—à–∏–±–∫–∞)"

# –¢–µ—Å—Ç 11: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏—Ä–∞–∂–∞ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ
echo "üéØ –¢–µ—Å—Ç 11: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏—Ä–∞–∂–∞ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ"
make_request "POST" "/draws" "" "–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏—Ä–∞–∂–∞ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ"

echo "=== –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ ==="
echo
echo "–î–ª—è –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:"
echo "curl -s $API_URL/draws | jq ."
echo "curl -s $API_URL/draws/$DRAW_ID/results | jq ."